/*!CK:1020031009!*//*1456170533,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["iV4KI"]); }

__d("P2PTransferRiskResult",[],function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports={SUCCESS:"SUCCESS",UNDER_MANUAL_REVIEW:"UNDER_MANUAL_REVIEW",REQUIRE_VERIFICATION:"REQUIRE_VERIFICATION"};},null);
__d('P2PChooseCreditCardForm.react',['CurrentEnvironment','P2PCreditCard','P2PCreditCardDetails.react','P2PText.react','React','XUIRadioList.react','cx','emptyFunction','fbt','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){'use strict';if(c.__markCompiled)c.__markCompiled();var r=m.Item,s=l.PropTypes,t='add_debit_card',u=h.messengerdotcom,v=l.createClass({displayName:'P2PChooseCreditCardForm',propTypes:{addCardOptionText:s.string,creditCards:s.arrayOf(s.instanceOf(i)),selectedCard:s.instanceOf(i).isRequired},getDefaultProps:function(){return {addCardOptionText:p._("New Debit Card"),creditCards:[],selectedCard:null,onChange:o,onAddDebitCardOptionSelected:o,showAddDebitCardOption:false};},getInitialState:function(){return {selectedValue:this.props.selectedCard.getCredentialId()};},getSelectedCard:function(){return this.props.creditCards.filter(function(w){return w.getCredentialId()===this.state.selectedValue;}.bind(this))[0];},onChange:function(w){var x;if(w===t){this.props.onAddDebitCardOptionSelected();this.setState({selectedValue:w});}else{x=this.props.creditCards.filter(function(y){return y.getCredentialId()===w;})[0];this.setState({selectedValue:x.getCredentialId()});this.props.onChange(x);}},renderCardItem:function(w,x){return (l.createElement(r,{className:"_2x6n",key:'item-'+x,value:w.getCredentialId()},l.createElement(j,{creditCard:w})));},renderAddDebitCardRadioItem:function(){return (l.createElement(r,{className:"_2x6n _1gri",key:'item-'+this.props.creditCards.length,value:t},l.createElement(k,{className:"_2jpa",type:'primary'},this.props.addCardOptionText)));},getRadioListItems:function(){var w=this.props.creditCards,x=w.map(this.renderCardItem);if(this.props.showAddDebitCardOption)x.push(this.renderAddDebitCardRadioItem());return x;},render:function(){return (l.createElement(m,{selectedValue:this.state.selectedValue,className:q(this.props.className,"_2x6r"+(u?' '+"_2jpb":'')),onValueChange:this.onChange},this.getRadioListItems()));}});f.exports=v;},null);
__d('P2PEditCreditCardDialog.react',['CreditCardFormParam','CurrentEnvironment','Link.react','React','P2PAPI','P2PAPIUtils','P2PCreditCard','P2PCreditCardForm.react','P2PLoadingMask.react','P2PLinkConstants','P2PDialog.react','P2PDialogTitle.react','P2PDialogBody.react','P2PDialogFooter.react','P2PButton.react','P2PText.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';if(c.__markCompiled)c.__markCompiled();var z='fbP2PEditCreditCardDialog_learnMoreSentenceID',aa=k.PropTypes,ba=k.createClass({displayName:'P2PEditCreditCardDialog',propTypes:{asyncRequestState:aa.object.isRequired,creditCard:aa.instanceOf(n).isRequired,onCancel:aa.func.isRequired,onSuccess:aa.func.isRequired,saveButtonText:aa.string,showCancelButton:aa.bool},getInitialState:function(){return {formData:{},isValid:false,loading:false,requestID:'',saveErrors:null};},getDefaultProps:function(){return {saveButtonText:y._("Save"),showCancelButton:true,width:i.messengerdotcom?350:300};},componentWillReceiveProps:function(ca){var da=ca.asyncRequestState?ca.asyncRequestState[this.state.requestID]:null;if(da){this.setState({requestID:''});if(da.error){this.handleOnSaveError(da.error);}else this.handleOnSaveSuccess(da);}},clearSaveErrors:function(){this.setState({saveErrors:null});},onSaveClick:function(ca){var da={},ea=m.genRequestID();da[h.CREDENTIAL_ID]=this.props.creditCard.getCredentialId();this.clearSaveErrors();this.setState({loading:true,requestID:ea});l.updateCreditCard(babelHelpers['extends']({requestID:ea},da,this.state.formData));},handleOnSaveSuccess:function(ca){this.props.onSuccess(ca);},onCancelClick:function(ca){this.props.onCancel();},handleOnSaveError:function(ca){this.setState({loading:false,saveErrors:ca});},isSaveDisabled:function(){return !this.state.isValid||this.state.loading;},isCancelDisabled:function(){return this.state.loading;},handleValidation:function(ca,da){this.setState({isValid:ca,formData:da});},getPrefilledFormData:function(){var ca={};ca[h.CARD_NUMBER]=this.props.creditCard.getCreditCardNumberMask();ca[h.CARD_EXPIRATION]=this.props.creditCard.getExpFormattedShort();ca[h.ZIP]=this.props.creditCard.getZipCode();return ca;},handleErrorDialogOKClick:function(){this.clearSaveErrors();},onToggle:function(ca){if(!ca)this.props.onCancel();},render:function(){var ca,da=this.props.text;if(!da)da=y._("Please update the expiration date for your card ending in {card numbers}.",[y.param('card numbers',this.props.creditCard.getCreditCardNumber())]);if(this.props.showCancelButton)ca=k.createElement(v,{use:'default',size:'medium',label:y._("Cancel"),disabled:this.isCancelDisabled(),onClick:this.onCancelClick});return (k.createElement(r,{behaviors:this.props.behaviors,layerHideOnBlur:false,onToggle:this.onToggle,repositionOnUpdate:true,shown:true,width:this.props.width},k.createElement(s,null,y._("Update Debit Card")),k.createElement(t,null,k.createElement(w,{className:"_3-96",type:'primary'},da),k.createElement(o,{onValidation:this.handleValidation,saveErrors:this.state.saveErrors,editMode:true,prefilledFormData:this.getPrefilledFormData(),cscMaxLength:this.props.creditCard.getMaxCSCLength()}),k.createElement(w,{className:"_3-8y",id:z,type:'secondary'},y._("Your payment info is stored securely. {Learn more about p2p link}",[y.param('Learn more about p2p link',k.createElement(j,{'aria-describedby':z,href:q.addDebitCardHelpURI,target:'_blank'},y._("Learn more.")))]))),k.createElement(u,null,ca,k.createElement(v,{use:'confirm',size:'medium',label:this.props.saveButtonText,disabled:this.isSaveDisabled(),onClick:this.onSaveClick})),k.createElement(p,{visible:this.state.loading})));}});f.exports=ba;},null);
__d('P2PConfirmAmountDialog.react',['CurrentEnvironment','React','P2PButton.react','P2PDialog.react','P2PDialogBody.react','P2PDialogFooter.react','P2PDialogTitle.react','P2PLoadingMask.react','P2PText.react','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s=i.PropTypes,t=h.messengerdotcom,u=i.createClass({displayName:'P2PConfirmAmountDialog',propTypes:{amount:s.string,currencySymbol:s.string,onCancel:s.func,onConfirm:s.func,receiverName:s.string},getDefaultProps:function(){return {amount:'',currencySymbol:'',onCancel:q,onConfirm:q,receiverName:s.string};},getInitialState:function(){return {loading:false};},handleCancelClick:function(){this.props.onCancel();},handleConfirmClick:function(){this.setState({loading:true});this.props.onConfirm();},getFormattedAmount:function(){return this.props.currencySymbol+''+this.props.amount;},render:function(){var v=t?350:300;return (i.createElement(k,{behaviors:this.props.behaviors,layerHideOnBlur:false,shown:true,width:v},i.createElement(n,{showCloseButton:false},r._("Confirm Payment")),i.createElement(l,null,i.createElement(p,{type:'primary'},r._("Do you want to pay {recipient name} {amount}?",[r.param('recipient name',this.props.receiverName),r.param('amount',this.getFormattedAmount())]))),i.createElement(m,null,i.createElement(j,{label:r._("Cancel"),onClick:this.handleCancelClick,use:'default'}),i.createElement(j,{label:r._("Pay"),onClick:this.handleConfirmClick,use:'confirm'})),i.createElement(o,{visible:this.state.loading})));}});f.exports=u;},null);
__d('P2PGroupSendDialog.react',['CurrentEnvironment','Image.react','immutable','ImmutableObject','MessengerContextualDialog.react','P2PActions','P2PLogger','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PText.react','React','ScrollableArea.react','XUIContextualDialog.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v){'use strict';if(c.__markCompiled)c.__markCompiled();var w=r.PropTypes,x=r.createClass({displayName:'P2PGroupSendDialog',propTypes:{amount:w.string,currency:w.string,flyoutAlignment:w.string,onToggle:w.func.isRequired,openRequestTab:w.bool,p2pEligibilities:w.object,participants:w.instanceOf(j.List),referrer:w.string,threadID:w.string.isRequired,threadFBID:w.string.isRequired},componentDidMount:function(){if(this.props.amount){this.log(o.UI_ACTN_INITIATE_GROUP_SEND_TRIGGER,{raw_amount:this.props.amount,currency:this.props.currency});}else this.log(o.UI_ACTN_INITIATE_GROUP_SEND);},log:function(y,z){n.log(y,babelHelpers['extends']({www_event_flow:p.UI_FLOW_P2P_GROUP_SEND},z));},_handleToggle:function(y){this.props.onToggle(y);this.log(o.UI_ACTN_GROUP_SEND_CANCELLED);},_handleBlur:function(){this._handleToggle(false);},isP2PIneligible:function(y){var z=this.props.p2pEligibilities;return z?z[y.userID]===false:true;},renderParticipantRow:function(y){var z=h.messengerdotcom,aa=z?32:40,ba=this.isP2PIneligible(y),ca;if(ba)ca=r.createElement(q,{className:"_4cof",type:'primary'},v._("Isn't able to receive money right now"));return (r.createElement('li',{className:"_4cog"+(ba?' '+"_4coh":''),key:y.id,onClick:this.handleGroupThreadClicked.bind(this,y)},r.createElement('div',{className:"_4coi"},r.createElement(i,{className:"_4coj",height:aa,src:y.big_image_src||y.image_src,width:aa})),r.createElement('div',{className:"_4cok"},r.createElement(q,{className:"_4col",type:'primary'},y.name),ca)));},renderGroupList:function(){return (r.createElement(s,{height:178},r.createElement('ul',null,this.props.participants?this.props.participants.map(this.renderParticipantRow):null)));},handleGroupThreadClicked:function(y){if(this.isP2PIneligible(y))return;this.props.onToggle(false);m.chatSendViewOpened({amount:this.props.amount,openRequestTab:this.props.openRequestTab,referrer:this.props.referrer,threadID:this.props.threadID,groupSendRecipientUserID:y.userID,groupThreadFBID:this.props.threadFBID});this.log(o.UI_ACTN_GROUP_SEND_RECIPIENT_PICKED,{raw_amount:this.props.amount,currency:this.props.currency,object_id:y.userID});},render:function(){var y=h.messengerdotcom,z=y?l:t,aa=y?302:280;return (r.createElement(z,{alignment:this.props.flyoutAlignment?this.props.flyoutAlignment:y?'right':'left',context:this.props.context,onBlur:this._handleBlur,onToggle:this._handleToggle,shown:true,width:aa,position:'above'},r.createElement('div',{className:"_4com"+(y?' '+"_4con":'')},r.createElement(q,{className:"_4coo",type:'primary',weight:'bold'},v._("Select a person")),this.renderGroupList())));}});f.exports=x;},null);
__d('P2PSendMoneyAmountInput.react',['CurrentEnvironment','React','ReactDOM','XUIError.react','P2PAmountUtils','cx','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o){'use strict';if(c.__markCompiled)c.__markCompiled();var p=i.PropTypes,q=1,r=i.createClass({displayName:'P2PSendMoneyAmountInput',propTypes:{currencySymbol:p.string,disabled:p.bool,isRequesting:p.bool,onInputChange:p.func,value:p.string},getDefaultProps:function(){return {currencySymbol:'$',disabled:false,isRequesting:false,onInputChange:n,value:''};},getInitialState:function(){var s;if(h.messengerdotcom){s=236;}else s=200;return {inputError:null,maxInputWidth:s,value:this.props.value,width:''};},componentDidMount:function(){this.updateAmount(this.state.value);if(!this.props.disabled)this.initDelayedFocus();},initDelayedFocus:function(){setTimeout(this.focus);},focus:function(){var s,t=this.state.value,u=0;if(this.isMounted()&&this.refs.textInput){s=j.findDOMNode(this.refs.textInput);s.focus();if(t){u=t.length;s.setSelectionRange(u,u);}}},handleAmountInputChange:function(s){var t=s.target.value;this.clearInputError();this.updateAmount(t);},clearInputError:function(){this.setState({inputError:null});},setInputError:function(s){this.setState({inputError:s});},handleAmountInputBlur:function(s){var t=s.target.value,u=t.split('.'),v=u[0],w=u[1];if(w){if(w.length===1)this.updateAmount(t+'0');}else if(w==='')this.updateAmount(v);},updateAmount:function(s){var t=true,u,v=l.isAmountOverLegalLimit(s);s=l.sanitizeAmount(s);u=parseFloat(s);if(v){t=false;this.setInputError(o._("Please enter a smaller amount"));}var w=s.split('.'),x=w[0],y=w[1];if(y!==undefined){s=(x&&parseFloat(x)!==0?x:'0')+'.'+y.substr(0,2);}else if(x)if(parseFloat(x)===0){s='0';}else if(x.length>1&&x[0]==='0')s=s.substr(1,s.length);this.setValue(s);u=parseFloat(s);t=t&&!isNaN(u)&&u>0;this.props.onInputChange(s,t);},setValue:function(s){this.setState({value:s},this.updateWidth);},updateWidth:function(){var s=this.getMockWidth();if(s)this.setState({width:Math.min(s,this.state.maxInputWidth)});},getMockWidth:function(){var s=j.findDOMNode(this.refs.mock_input);return s.offsetWidth+q;},render:function(){var s,t=!this.state.value.length,u,v;if(t)s=i.createElement('div',{ref:'placeholder_input',className:"_1-sv"},'0');return (i.createElement('div',{className:"_ipw"+(this.props.isRequesting?' '+"_1c9h":'')},i.createElement('label',null,v,i.createElement('div',{className:"_4puh"+(t?' '+"_1-sy":'')},u,s,i.createElement('div',{ref:'mock_input',className:"_5fbs"},this.state.value),i.createElement(k,{xuiError:this.state.inputError},i.createElement('span',{className:"_1-sz"},i.createElement('input',{autofocus:true,className:"_5fbv",disabled:this.props.disabled,onBlur:this.handleAmountInputBlur,onChange:this.handleAmountInputChange,ref:'textInput',style:{width:this.state.width},value:this.state.value})))))));}});f.exports=r;},null);
__d('P2PVerifyCreditCardDialog.react',['CreditCardFormParam','CurrentEnvironment','FBPaymentsCreditCardCVCFormField.react','FBPaymentsCreditCardZipCodeFormField.react','FBPaymentsErrorNotice.react','P2PAPI','P2PAPIUtils','P2PButton.react','P2PCreditCard','P2PDialog.react','P2PDialogBody.react','P2PDialogFooter.react','P2PDialogTitle.react','P2PLoadingMask.react','P2PText.react','PaymentMethodUtils','React','cx','emptyFunction','fbt','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba){if(c.__markCompiled)c.__markCompiled();var ca=x.PropTypes,da=x.createClass({displayName:'P2PVerifyCreditCardDialog',propTypes:{asyncRequestState:ca.object,creditCard:ca.instanceOf(p),onCancel:ca.func,onConfirm:ca.func,isPurchasing:ca.bool,isSending:ca.bool,purchaseName:ca.string,saveButtonText:ca.string,showCancelButton:ca.bool},getDefaultProps:function(){return {asyncRequestState:{},creditCard:null,isPurchasing:false,isSending:true,onCancel:z,onError:z,onSuccess:z,purchaseName:'',saveButtonText:aa._("Confirm"),showCancelButton:true,width:i.messengerdotcom?320:300};},getInitialState:function(){var ea={};ea[h.CSC]={};ea[h.CSC].valid=false;if(this.shouldShowZIPInput()){ea[h.ZIP]={};ea[h.ZIP].valid=false;}return {isValid:false,loading:false,requestID:'',saveError:null,fields:ea};},componentWillReceiveProps:function(ea){var fa=ea.asyncRequestState?ea.asyncRequestState[this.state.requestID]:null;if(fa){this.setState({requestID:''});if(fa.error){this.handleOnSaveError(fa.error);}else this.handleOnSaveSuccess(fa);}},handleOnSaveSuccess:function(ea){this.props.onSuccess(ea);},handleOnSaveError:function(ea){this.setState({loading:false,saveError:ea});},clearSaveError:function(){this.setState({saveError:null});},handleCancelClick:function(){this.props.onCancel();},handleConfirmClick:function(){var ea={},fa=n.genRequestID();ea[h.CREDENTIAL_ID]=this.props.creditCard.getCredentialId();ea[h.CSC]=this.state.fields[h.CSC].value;if(this.state.fields[h.ZIP])ea[h.ZIP]=this.state.fields[h.ZIP].value;this.clearSaveError();this.setState({loading:true,requestID:fa});m.verifyCreditCard(babelHelpers['extends']({requestID:fa},ea));},handleFormValueChange:function(ea,fa,ga){var ha=this.state.fields;ha[ea].value=fa;ha[ea].valid=ga;this.setState({fields:ha});this.validateForm();},validateForm:function(){var ea=true,fa=this.state.fields;ea=!ba(fa).some(function(ga){return !ga.valid;});this.setState({isValid:ea});},handleToggle:function(ea){if(!ea)this.props.onCancel();},shouldShowZIPInput:function(){var ea=!!this.props.creditCard.getZipCode();return !ea;},renderError:function(){var ea;if(this.state.saveError)ea=x.createElement(l,{error:this.state.saveError});return ea;},renderCVCFormField:function(){return (x.createElement(j,{cscMaxLength:this.props.creditCard.getMaxCSCLength(),initiallyFocused:true,name:'csc',onChange:this.handleFormValueChange,showFocusOutline:false,showIcon:false,showPlaceholder:false,showSecondaryIcon:true,showSecondaryIconAlways:true}));},renderZIPFormField:function(){return (x.createElement(k,{onChange:this.handleFormValueChange,name:'zip',showIcon:false,showPlaceholder:false,showFocusOutline:false}));},getMessage:function(){var ea=this.props.creditCard,fa=ea.getName(),ga=ea.getCreditCardNumber(),ha=w.getCardTypeFromCode(ea.getCardType()).name!=='amex';if(this.props.isPurchasing){if(this.shouldShowZIPInput()){if(ha){return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the back of your {credit card issuer} ending in {credit card number last 4 digits} and Billing ZIP Code to get {Purchase item}.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga),aa.param('Purchase item',this.props.purchaseName)])));}else return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the front of your {credit card issuer} ending in {credit card number last 4 digits} and Billing ZIP Code to get {Purchase item}.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga),aa.param('Purchase item',this.props.purchaseName)])));}else if(ha){return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the back of your {credit card issuer} ending in {credit card number last 4 digits} to get {Purchase item}.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga),aa.param('Purchase item',this.props.purchaseName)])));}else return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the front of your {credit card issuer} ending in {credit card number last 4 digits} to get {Purchase item}.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga),aa.param('Purchase item',this.props.purchaseName)])));}else if(this.props.isSending){if(this.shouldShowZIPInput()){if(ha){return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the back of your {credit card issuer} ending in {credit card number last 4 digits} and Billing ZIP Code to send this payment.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga)])));}else return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the front of your {credit card issuer} ending in {credit card number last 4 digits} and Billing ZIP Code to send this payment.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga)])));}else if(ha){return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the back of your {credit card issuer} ending in {credit card number last 4 digits} to send this payment.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga)])));}else return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the front of your {credit card issuer} ending in {credit card number last 4 digits} to send this payment.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga)])));}else if(this.shouldShowZIPInput()){if(ha){return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the back of your {credit card issuer} ending in {credit card number last 4 digits} and Billing ZIP Code to accept this payment.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga)])));}else return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the front of your {credit card issuer} ending in {credit card number last 4 digits} and Billing ZIP Code to accept this payment.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga)])));}else if(ha){return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the back of your {credit card issuer} ending in {credit card number last 4 digits} to accept this payment.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga)])));}else return (x.createElement(v,{type:'primary'},aa._("Enter the security code on the front of your {credit card issuer} ending in {credit card number last 4 digits} to accept this payment.",[aa.param('credit card issuer',fa),aa.param('credit card number last 4 digits',ga)])));},getInputs:function(){var ea,fa=x.createElement('div',{className:"_3yfa"},x.createElement(v,{className:"_197h",type:'primary'},aa._("Security Code")),x.createElement('div',{className:"_197i"},this.renderCVCFormField()));if(this.shouldShowZIPInput())ea=x.createElement('div',{className:"_3yfb"},x.createElement(v,{className:"_197h",type:'primary'},aa._("Billing ZIP Code")),x.createElement('div',{className:"_197i"},this.renderZIPFormField()));return (x.createElement('div',null,fa,ea));},render:function(){var ea;if(this.props.showCancelButton)ea=x.createElement(o,{use:'default',size:'medium',label:aa._("Cancel"),disabled:this.state.loading,onClick:this.props.onCancel});return (x.createElement(q,{behaviors:this.props.behaviors,className:i.messengerdotcom?"_4ypw":'',layerHideOnBlur:false,onToggle:this.handleToggle,ref:'dialog',repositionOnUpdate:true,shown:true,width:this.props.width},x.createElement(t,null,aa._("Enter Security Code")),x.createElement(r,null,x.createElement('div',{className:"_197f"},this.getMessage()),this.renderError(),x.createElement('div',{className:"_197g"},this.getInputs())),x.createElement(s,null,ea,x.createElement(o,{label:this.props.saveButtonText,onClick:this.handleConfirmClick,disabled:!this.state.isValid||this.state.loading,use:'confirm'})),x.createElement(u,{visible:this.state.loading})));}});f.exports=da;},null);
__d('P2PSendMoneyDialog.react',['Arbiter','CreditCardFormParam','CurrentEnvironment','Image.react','ImageBlock.react','Link.react','MessengerContextualDialog.react','P2PAPI','P2PAddCreditCardDialog.react','P2PButton.react','P2PBigAmount.react','P2PCreditCardStore','P2PChooseCreditCardForm.react','P2PConfirmAmountDialog.react','P2PCreditCard','P2PDialog.react','P2PDialogTitle.react','P2PEditCreditCardDialog.react','P2PGKValues','P2PLinkConstants','P2PLoadingMask.react','P2PLogger','P2PMemoField.react','P2PMemoText.react','P2PPaymentLoggerEvent','P2PPaymentLoggerEventFlow','P2PSendMoneyAmountInput.react','P2PSendMoneyDialogActionHeader.react','P2PText.react','P2PVerifyCreditCardDialog.react','React','ReactLayeredComponentMixin','XUIContextualDialog.react','XUISpinner.react','cx','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da,ea,fa,ga,ha,ia,ja,ka,la,ma,na,oa,pa,qa){'use strict';if(c.__markCompiled)c.__markCompiled();var ra=la.PropTypes,sa=j.messengerdotcom,ta=z.P2PRequestMoneyEnabled,ua=qa._("Change"),va=qa._("Add Debit Card"),wa=100,xa=la.createClass({displayName:'P2PSendMoneyDialog',mixins:[ma],propTypes:{amount:ra.string,currency:ra.string.isRequired,currencySymbol:ra.string.isRequired,groupThreadFBID:ra.string,flyoutAlignment:ra.string,openRequestTab:ra.bool,memoText:ra.string,onError:ra.func.isRequired,onPaymentRequestError:ra.func.isRequired,onPaymentRequestSuccess:ra.func.isRequired,onSendSuccess:ra.func.isRequired,onToggle:ra.func.isRequired,platformData:ra.object,receiver:ra.object,referrer:ra.string,paymentRequestID:ra.string,p2pEligibilities:ra.object,useModal:ra.bool},getDefaultProps:function(){return {amount:'',openRequestTab:false,receiver:{},useModal:false};},getInitialState:function(){var ya=s.getAll();return {asyncRequestState:s.getAsyncRequestState(),addCreditCardDialogShown:false,amount:this.props.amount,creditCardsFetchError:s.failedCreditCardFetch(),creditCards:ya,confirmAmountDialogShown:false,isAmountValid:!!this.props.paymentRequestID,isCreditCardsFetchComplete:s.isCreditCardsFetchComplete(),isMemoPhotoUploading:false,isPaying:!this.props.openRequestTab,isRequesting:this.props.openRequestTab,loading:false,memoText:this.props.memoText,memoPhotoIDs:[],selectedCard:ya[0],showChooseCreditCardForm:false,verifyCreditCardDialogShown:false};},creditCardStoreSub:null,_isAmountVerified:false,passwordCancelSubscribeToken:null,getEventFlow:function(){return (this.props.paymentRequestID||this.isRequesting()?ga.UI_FLOW_P2P_REQUEST:ga.UI_FLOW_P2P_SEND);},log:function(ya,za){ca.log(ya,babelHelpers['extends']({www_event_flow:this.getEventFlow(),object_id:this.props.receiver&&this.props.receiver.userID,memo_text:this.state.memoText,request_id:this.props.paymentRequestID},this.getPlatformLoggingData(),za,this.getReferrer()));},componentWillUnmount:function(){if(this.passwordCancelSubscribeToken!==null){h.unsubscribe(this.passwordCancelSubscribeToken);this.passwordCancelSubscribeToken=null;}if(this.creditCardStoreSub){this.creditCardStoreSub.remove();this.creditCardStoreSub=null;}},componentWillMount:function(){this.creditCardStoreSub=s.addListener('change',this.onCreditCardStoreChange);this.log(fa.UI_ACTN_INITIATE_SEND);},getPlatformLoggingData:function(){var ya=this.props.platformData&&this.props.platformData.loggingData;if(ya)return {platform_logging_data:ya};return null;},getReferrer:function(){var ya=this.props.referrer;if(ya)return {www_event_referrer:ya};return null;},onAmountInputChange:function(ya,za){this.setState({amount:ya,isAmountValid:za});},onCreditCardStoreChange:function(){var ya=s.getAll(),za;if(this.state.selectedCard)za=ya.filter(function(ab){return (ab.getCredentialId()===this.state.selectedCard.getCredentialId());}.bind(this))[0];if(!za)za=ya[0];this.setState({asyncRequestState:s.getAsyncRequestState(),creditCards:ya,isCreditCardsFetchComplete:s.isCreditCardsFetchComplete(),selectedCard:za,creditCardsFetchError:s.failedCreditCardFetch()});},shouldShowConfirmAmountDialog:function(){var ya=this.state.amount,za=ya?ya.replace(/\,/g,''):'',ab=parseFloat(za);return (!this._isAmountVerified&&ab>=wa);},shouldShowVerifyCreditCardDialog:function(){return !this.state.selectedCard.getIsVerified();},shouldShowEditCreditCardDialog:function(){return this.state.selectedCard.isExpired();},handleSendClick:function(ya){if(this.isSendButtonDisabled())return false;this.log(fa.UI_ACTN_SEND_CLICKED,{raw_amount:this.state.amount,currency:this.props.currency});this._isAmountVerified=false;this.initiatePayment();},handleRequestClick:function(ya){if(this.isRequestButtonDisabled())return false;this.log(fa.UI_ACTN_REQUEST_CLICKED,{raw_amount:this.state.amount,currency:this.props.currency});this.createPaymentRequest();},initiatePayment:function(){if(this.shouldShowConfirmAmountDialog()){this.hideAllDialogs();this.setState({confirmAmountDialogShown:true});this.log(fa.UI_ACTN_CONFIRM_AMOUNT,{raw_amount:this.state.amount,currency:this.props.currency});return;}else if(this.shouldShowEditCreditCardDialog()){this.hideAllDialogs();this.setState({editCreditCardDialogShown:true});this.log(fa.UI_ACTN_EDIT_CARD,{raw_amount:this.state.amount,currency:this.props.currency});return;}else if(this.shouldShowVerifyCreditCardDialog()){this.hideAllDialogs();this.setState({verifyCreditCardDialogShown:true});this.log(fa.UI_ACTN_VERIFY_CSC,{raw_amount:this.state.amount,currency:this.props.currency});return;}this.createTransaction();},isPayingForRequest:function(){return !!this.props.paymentRequestID;},isPaying:function(){return this.state.isPaying===true;},isRequesting:function(){return this.state.isRequesting===true;},shouldShowLoading:function(){return (!this.state.addCreditCardDialogShown&&!this.state.confirmAmountDialogShown&&!this.state.verifyCreditCardDialogShown&&!this.state.editCreditCardDialogShown);},createTransaction:function(){var ya={};this.setState({loading:this.shouldShowLoading()});ya[i.CREDENTIAL_ID]=this.state.selectedCard.getCredentialId();ya.amount=this.state.amount;ya.receiverId=this.props.receiver&&this.props.receiver.userID;ya.memoText=this.state.memoText;ya.memoPhotoIDs=this.state.memoPhotoIDs;ya.paymentRequestID=this.props.paymentRequestID;if(this.props.groupThreadFBID)ya.group_thread_fbid=this.props.groupThreadFBID;if(this.props.platformData)ya.platform_context_id=this.props.platformData.platformContextID;this.passwordCancelSubscribeToken=h.subscribeOnce('PasswordReauthDialogCancelClick',this.handlePasswordReauthDialogCancelClick);o.createTransaction({formData:ya,error:this.setCreateTransferError,success:this.setCreateTransferSuccess});this.log(fa.UI_ACTN_CONFIRM_SEND,{raw_amount:this.state.amount,currency:this.props.currency});},createPaymentRequest:function(){this.setState({loading:this.shouldShowLoading()});o.createPaymentRequest({formData:{amount:this.state.amount,memoText:this.state.memoText,group_thread_fbid:this.props.groupThreadFBID,requesteeID:this.props.receiver&&this.props.receiver.userID},error:this.setCreatePaymentRequestError,success:this.setCreatePaymentRequestSuccess});this.log(fa.UI_ACTN_CONFIRM_REQUEST,{raw_amount:this.state.amount,currency:this.props.currency});},hideAllDialogs:function(){this.setState({addCreditCardDialogShown:false,confirmAmountDialogShown:false,verifyCreditCardDialogShown:false,editCreditCardDialogShown:false});},isDialogShowing:function(){return !!(this.state.addCreditCardDialogShown||this.state.confirmAmountDialogShown||this.state.verifyCreditCardDialogShown||this.state.editCreditCardDialogShown);},setCreateTransferError:function(ya){if(this.isMounted()){this.hideAllDialogs();this.setState({loading:false});}this.props.onError(ya);this.log(fa.UI_ACTN_SEND_FAIL);},setCreateTransferSuccess:function(ya){if(this.isMounted()){this.setState({loading:false});this.hideAllDialogs();}this.props.onSendSuccess(ya);this.log(fa.UI_ACTN_SEND_SUCCESS);},setCreatePaymentRequestError:function(ya){if(this.isMounted()){this.hideAllDialogs();this.setState({loading:false});}this.props.onPaymentRequestError(ya.error);this.log(fa.UI_ACTN_REQUEST_FAIL);},setCreatePaymentRequestSuccess:function(ya){if(this.isMounted()){this.setState({loading:false});this.hideAllDialogs();}this.props.onPaymentRequestSuccess();this.log(fa.UI_ACTN_REQUEST_SUCCESS,{request_id:ya.id});},handlePasswordReauthDialogCancelClick:function(){this.passwordCancelSubscribeToken=null;this.setState({loading:false});this.hideAllDialogs();},onAddCreditCardCancel:function(){this.setState({addCreditCardDialogShown:false});},onAddCreditCardSuccess:function(ya){var za=this.state.creditCards.filter(function(ab){var bb=ab.getCredentialId();return (ya[i.CREDENTIAL_ID]===bb);})[0];this.setState({selectedCard:za});if(this.state.isAmountValid){this.initiatePayment();}else{this.setState({addCreditCardDialogShown:false});this.focusAmountInput();}},onEditCreditCardSuccess:function(){this.initiatePayment();},onEditCreditCardCancel:function(){this.setState({editCreditCardDialogShown:false});},focusAmountInput:function(){if(this.refs.send_money_amount_input)this.refs.send_money_amount_input.focus();},_handleToggle:function(ya){this.props.onToggle(ya);if(!this.state.loading)this.log(fa.UI_ACTN_SEND_MONEY_CANCELLED);},_handleBlur:function(){this._handleToggle(false);},handleAddCreditCardClick:function(){this.setState({addCreditCardDialogShown:true,showChooseCreditCardForm:false});this.log(fa.UI_ACTN_CHANGE_CARD);},handleBackClick:function(){this.setState({showChooseCreditCardForm:false},function(){this.focusAmountInput();}.bind(this));},handleChooseCardNextClick:function(){var ya=this.refs.choose_credit_card_form.getSelectedCard();this.setState({selectedCard:ya,showChooseCreditCardForm:false},function(){this.focusAmountInput();}.bind(this));},handleAddCardNextClick:function(){this.setState({addCreditCardDialogShown:true});},handleChangeSelectedCardClick:function(){var ya={};if(this.state.creditCards.length===1){ya.addCreditCardDialogShown=true;this.log(fa.UI_ACTN_CHANGE_CARD);}else{ya.showChooseCreditCardForm=true;this.log(fa.UI_ACTN_INITIATE_CHOOSE_CARD);}this.setState(ya);},onConfirmAmountCancel:function(){this.setState({confirmAmountDialogShown:false});},onConfirmAmountSuccess:function(){this._isAmountVerified=true;this.initiatePayment();},onVerifyCreditCardSuccess:function(){this.initiatePayment();},onVerifyCreditCardCancel:function(){this.setState({verifyCreditCardDialogShown:false});},handleMemoTextChange:function(ya){this.setState({memoText:ya});},handleMemoPhotoChange:function(ya){this.setState({memoPhotoIDs:ya});},handleMemoPhotoUploadingChange:function(ya){this.setState({isMemoPhotoUploading:ya});},isSendButtonDisabled:function(){return (!this.state.isAmountValid||!this.state.creditCards.length||this.state.loading||this.state.isMemoPhotoUploading);},isRequestButtonDisabled:function(){return !this.state.isAmountValid||this.state.loading;},isAddCardNextButtonDisabled:function(){return !this.state.isAmountValid;},renderAddDebitCardLink:function(){return (la.createElement(ja,{className:"_42h3",type:'secondary',ref:'send_money_dialog_add_card_text'},la.createElement(m,{className:"_49nm",href:'#',onClick:this.handleAddCreditCardClick},va)));},renderSelectedCard:function(){var ya=this.state.selectedCard;return (la.createElement(ja,{className:"_21x5",size:'small',type:'primary'},la.createElement('div',{className:"_49nn"},ya.getName()),la.createElement('div',{className:"_21wx"},ya.getCreditCardNumberFormatted()),la.createElement('div',{className:"_21ww"},'\u00b7'),la.createElement(m,{className:"_21wy",onClick:this.handleChangeSelectedCardClick,href:'#'},ua)));},renderFormButtons:function(){var ya,za=sa&&this.props.useModal?la.createElement(q,{label:qa._("Cancel"),onClick:function(){this._handleToggle(false);}.bind(this),type:'secondary'}):null;if(this.isRequesting()){ya=la.createElement('div',null,za,this.renderRequestButton());}else if(!this.state.creditCards.length){ya=la.createElement('div',null,za,this.renderAddCardNextButton());}else if(this.state.showChooseCreditCardForm){ya=la.createElement('div',null,this.renderChooseCardBackButton(),this.renderChooseCardNextButton());}else ya=la.createElement('div',null,za,this.renderPayButton());return ya;},renderChooseCardBackButton:function(){return (la.createElement(q,{label:qa._("Back"),onClick:this.handleBackClick,ref:'back_button',size:'medium',type:'secondary',use:'default'}));},renderAddCardNextButton:function(){return (la.createElement(q,{disabled:this.isAddCardNextButtonDisabled(),label:qa._("Next"),onClick:this.handleAddCardNextClick,ref:'add_card_next_button',size:'medium',type:'primary',use:'default'}));},renderChooseCardNextButton:function(){return (la.createElement(q,{label:qa._("Next"),onClick:this.handleChooseCardNextClick,ref:'choose_card_next_button',size:'medium',type:'primary',use:'confirm'}));},renderPayButton:function(){return (la.createElement(q,{disabled:this.isSendButtonDisabled(),label:qa._("Pay"),onClick:this.handleSendClick,ref:'send_button',size:'medium',type:'primary',use:'confirm'}));},renderRequestButton:function(){return (la.createElement(q,{disabled:this.isRequestButtonDisabled(),label:qa._("Request"),onClick:this.handleRequestClick,ref:'request_button',size:'medium',type:'primary',use:'confirm'}));},renderPaymentDetails:function(){var ya;if(this.isRequesting())return null;if(this.state.creditCards.length){if(this.state.showChooseCreditCardForm){ya=this.renderAddDebitCardLink();}else ya=this.renderSelectedCard();}else if(this.state.creditCardsFetchError){ya=la.createElement('div',{className:"_2abl"},la.createElement(ja,{type:'secondary',ref:'send_money_dialog_add_card_next_text'},qa._("Sorry, we couldn't fetch your details. Please check your internet connection or refresh this page and try again.")));}else ya=la.createElement('div',{className:"_2abl"},la.createElement(ja,{type:'secondary',ref:'send_money_dialog_add_card_next_text'},qa._("Sending money is free and secure")));return ya;},isRecipientIneligible:function(){var ya=this.props.receiver;return !!(ya&&this.props.p2pEligibilities&&this.props.p2pEligibilities[ya.userID]===false);},renderFooter:function(){var ya,za=this.props.receiver,ab=za?za.short_name:'';if(this.isRecipientIneligible()){ya=la.createElement(ja,{className:"_2pi8",type:'secondary'},qa._("{receiverName} isn't able to receive money right now. {Learn more about p2p link}",[qa.param('receiverName',ab),qa.param('Learn more about p2p link',la.createElement(m,{href:aa.receiverIneligibleHelpURI,target:'_blank'},qa._("Learn More.")))]));}else if(!this.state.isCreditCardsFetchComplete){ya=la.createElement('div',{className:"_2-vg"},la.createElement(oa,{className:"_2-vh"}));}else ya=[la.createElement('div',{className:"_21x4",key:'paymentDetails'},this.renderPaymentDetails()),la.createElement('div',{className:"_4zf-",key:'formButtons'},this.renderFormButtons())];return (la.createElement('div',{className:"_5p-k"},ya));},renderMemo:function(){var ya=this.isPayingForRequest(),za=this.props.memoText||this.state.memoText;if(!z.P2PWWWMemoField||ya&&!za)return null;if(ya&&za)return (la.createElement('div',{className:"_5exl"},la.createElement(ea,{memoText:za})));return (la.createElement('div',{className:"_5exl"},la.createElement(da,{defaultValue:za,disabled:this.isRecipientIneligible(),isRequesting:this.isRequesting(),onTextChange:this.handleMemoTextChange,onPhotoChange:this.handleMemoPhotoChange,onPhotoUploadingChange:this.handleMemoPhotoUploadingChange})));},renderSendMoneyForm:function(){var ya=sa?32:40,za=qa._("Send to");if(this.isRequesting())za=qa._("Request to");return (la.createElement('div',null,la.createElement('div',{className:"_49no",ref:'send_money_dialog_title'},la.createElement(l,{spacing:'large'},la.createElement(k,{className:"_5p-i",height:ya,src:this.props.receiver&&(this.props.receiver.big_image_src||this.props.receiver.image_src),width:ya}),la.createElement('div',{className:"_3-8w"},la.createElement(ja,{type:'secondary'},za),la.createElement(ja,{className:"_5p-j",size:'small',type:'primary',weight:'bold'},this.props.receiver&&this.props.receiver.name))),la.createElement(m,{className:"_49np",href:aa.helpCenterURI,target:'_blank'})),la.createElement('div',{className:"_2abm"},this.renderMainContainer()),this.renderMemo(),la.createElement('div',{className:"_21w-"+(this.isRecipientIneligible()?' '+"_3orf":'')+(sa?' '+"_4eb_":'')},this.renderFooter())));},renderMainContainer:function(){var ya,za,ab=this.state.amount,bb=this.isPayingForRequest();if(this.state.showChooseCreditCardForm){ya=la.createElement('div',{className:"_xn7"},la.createElement(t,{creditCards:this.state.creditCards,selectedCard:this.state.selectedCard,ref:'choose_credit_card_form'}));}else{if(!bb){za=la.createElement(ha,{currencySymbol:this.props.currencySymbol,disabled:this.isPayingForRequest()||this.isRecipientIneligible(),isRequesting:this.isRequesting(),onInputChange:this.onAmountInputChange,ref:'send_money_amount_input',value:ab});}else za=la.createElement(r,{amount:ab,size:'large'});ya=la.createElement('div',{className:"_2abn"+(bb?' '+"_74p":'')},za);}return ya;},renderActionToggleHeader:function(){var ya=this.isPaying(),za=this.isRequesting();if(this.isPayingForRequest()||!ta)return null;return (la.createElement('div',{className:"_4uvi"},la.createElement(ia,{isPaying:ya,isRequesting:za,onPayClick:function(){if(!this.isPaying())this.setState({isPaying:true,isRequesting:false},function(){this.focusAmountInput();this.log(fa.UI_ACTN_INITIATE_SEND);}.bind(this));}.bind(this),onRequestClick:function(){if(!this.isRequesting())this.setState({isPaying:false,isRequesting:true},function(){this.focusAmountInput();this.log(fa.UI_ACTN_INITIATE_REQUEST);}.bind(this));}.bind(this)})));},renderLayers:function(){var ya={},za,ab,bb=this.props.receiver&&this.props.receiver.short_name,cb;if(this.props.useModal)cb={LayerFadeOnShow:false};if(this.state.addCreditCardDialogShown){if(this.state.isAmountValid){ab=qa._("Please enter a debit card to send {Amount} to {Recipient name}. Credit cards can't be used.",[qa.param('Amount',this.props.currencySymbol+this.state.amount),qa.param('Recipient name',bb)]);za=qa._("Pay");}ya.addCreditCard=la.createElement(p,{behaviors:cb,eventFlow:this.getEventFlow(),loggingData:this.getPlatformLoggingData(),onCancel:this.onAddCreditCardCancel,onSuccess:this.onAddCreditCardSuccess,ref:'send_money_dialog_add_credit_card_form',saveButtonText:za,showCancelButton:!!sa,text:ab});}else if(this.state.confirmAmountDialogShown){ya.confirmAmount=la.createElement(u,{amount:this.state.amount,behaviors:cb,currencySymbol:this.props.currencySymbol,onCancel:this.onConfirmAmountCancel,onConfirm:this.onConfirmAmountSuccess,receiverName:bb});}else if(this.state.verifyCreditCardDialogShown){ya.verifyCreditCard=la.createElement(ka,{asyncRequestState:this.state.asyncRequestState,behaviors:cb,creditCard:this.state.selectedCard,isSending:true,onCancel:this.onVerifyCreditCardCancel,onSuccess:this.onVerifyCreditCardSuccess});}else if(this.state.editCreditCardDialogShown)ya.confirmAmount=la.createElement(y,{asyncRequestState:this.state.asyncRequestState,behaviors:cb,creditCard:this.state.selectedCard,onCancel:this.onEditCreditCardCancel,onSuccess:this.onEditCreditCardSuccess});return ya;},renderIneligibleMask:function(){if(!this.isRecipientIneligible())return null;return la.createElement('div',{className:"_3org"});},render:function(){var ya,za=null,ab={},bb=sa?286:260;if(this.props.useModal&&this.isDialogShowing())return null;if(this.props.useModal){ya=w;za=la.createElement(x,{className:"_30wi"},qa._("Confirm Payment"));ab={layerHideOnBlur:false};bb=sa?380:312;}else{ya=sa?n:na;ab={alignment:this.props.flyoutAlignment?this.props.flyoutAlignment:sa?'right':'left',context:this.props.context,position:this.props.position||'above',onBlur:this._handleBlur};}return (la.createElement(ya,babelHelpers['extends']({onToggle:this._handleToggle,shown:true,width:bb},ab),la.createElement('div',{className:"_21x9"+(sa?' '+"_1pka":'')+(ta?' '+"_4uvl":'')+(this.props.useModal?' '+"_35wt":'')},za,this.renderActionToggleHeader(),this.renderSendMoneyForm(),this.renderIneligibleMask(),la.createElement(ba,{ref:'send_money_dialog_loader',visible:this.state.loading}))));}});f.exports=xa;},null);