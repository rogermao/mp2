/*!CK:1849035322!*//*1456170532,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ufQ\/B"]); }

__d('MessagesEmoticons.react',['Grid.react','React','cx','emptyFunction','fbt'],function a(b,c,d,e,f,g,h,i,j,k,l){if(c.__markCompiled)c.__markCompiled();var m=h.GridItem,n=i.PropTypes,o=8,p={smile:l._("smile"),frown:l._("frown"),tongue:l._("tongue"),grin:l._("grin"),gasp:l._("gasp"),wink:l._("wink"),pacman:l._("pacman"),grumpy:l._("grumpy"),unsure:l._("unsure"),cry:l._("cry"),kiki:l._("kiki"),glasses:l._("glasses"),sunglasses:l._("sunglasses"),heart:l._("heart"),devil:l._("devil"),angel:l._("angel"),squint:l._("squint"),confused:l._("confused"),upset:l._("upset"),colonthree:l._("colonthree"),like:l._("like")},q=i.createClass({displayName:'MessagesEmoticons',propTypes:{onEmoticonSelect:n.func},getDefaultProps:function(){return {onEmoticonSelect:k};},getEmoticons:function(){return Object.keys(p).map(function(r){return (i.createElement(m,{key:r},i.createElement('div',{className:"panelCell"},i.createElement('a',{'aria-label':p[r],className:'emoticon emoticon_'+r,onClick:function(){return this.props.onEmoticonSelect(r);}.bind(this)}))));}.bind(this));},render:function(){return (i.createElement('div',{className:"emoticonsTable"},i.createElement(h,{cols:o,alignv:'middle',alignh:'center',spacing:'pam'},this.getEmoticons())));}});f.exports=q;},null);
__d('StickerSearch',['StickerServerRequests'],function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();var i,j={requestStickersForQuery:function(k,l,m){i=k;h.getStickersForQuery(k,l,function(n){return i===k&&m(n.payload);});}};f.exports=j;},null);
__d('StickersFlyoutPackSelector.react',['Animation','ImmutableObject','Locale','React','ReactDOM','Image.react','StickerActions','StickerConfig','StickerConstants','StickerInterfaces','StickerState','StickerStoreController','XUIBadge.react','cx','emptyFunction','fbt','ix','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y){'use strict';if(c.__markCompiled)c.__markCompiled();var z=k.PropTypes,aa=4,ba=200,ca=w._("Sticker Store"),da=k.createClass({displayName:'StickersFlyoutPackSelector',propTypes:{stickerInterface:z.oneOf(y(q)),numNewPacks:z.number,packs:z.arrayOf(z.instanceOf(i)).isRequired,selectedPackID:z.string,resetTagSelectorFunc:z.func},getInitialState:function(){return {animating:false,page:0};},getDefaultProps:function(){return {stickerInterface:q.MESSAGES,numNewPacks:0};},shouldComponentUpdate:function(fa,ga){return !ga.animating;},onFlyoutShown:function(){if(this.props.packs.length>0){var fa=this._calculatePageForPack(this.props.selectedPackID);if(this.state.page!==fa)this._setPage(fa,0);}},_calculatePageForPack:function(fa){for(var ga=0;ga<this.props.packs.length;ga++)if(this.props.packs[ga].id==fa)return ga<=aa?0:Math.floor((ga-1)/aa);return 0;},_setPage:function(fa,ga){if(this.state.animating)return;this.setState({animating:true,page:fa},function(){var ha=l.findDOMNode(this.refs.positioner),ia=this._calculatePosition(fa);new h(ha).to(ia.reference,ia.offset+'px').ondone(function(){return this.setState({animating:false});}.bind(this)).duration(ga).go();});},_calculatePosition:function(fa){var ga=l.findDOMNode(this.refs.positioner),ha=ga.childNodes[fa].offsetLeft;if(j.isRTL()){var ia=ga.offsetWidth,ja=ga.childNodes[fa].offsetWidth;return {reference:'right',offset:ha+ja-ia};}return {reference:'left',offset:-ha};},_numPages:function(){return Math.max(1,Math.ceil((this.props.packs.length-1)/aa));},_canGoPrev:function(){return this.state.page>0;},_canGoNext:function(){return this.state.page+1<this._numPages();},_goPrev:function(){this._canGoPrev()&&this._setPage(this.state.page-1,ba);},_goNext:function(){this._canGoNext()&&this._setPage(this.state.page+1,ba);},_openStore:function(){n.resetNumNewPacks();var fa=this.props.stickerInterface==q.COMPOSER;s.showStore(null,fa);},render:function(){return (k.createElement('div',{className:"_5r85"},this._renderStoreButton(),this._renderPrevArrow(),this._renderNextArrow(),k.createElement('div',{className:"_5r88"},k.createElement('div',{className:"_5r89",ref:'positioner'},this._renderPages()))));},_selectPack:function(fa){var ga=r.getPack(fa);if(ga&&ga.isPromoted)n.addPack(fa);if(fa===p.SEARCH_PACK_ID)this.props.resetTagSelectorFunc();n.selectPack(fa);},_renderPages:function(){var fa=this.props.packs.map(function(ja,ka){return (k.createElement(ea,{key:ja.id,onClick:function(){return this._selectPack(ja.id);}.bind(this),pack:ja,selected:this.props.selectedPackID===ja.id,index:ka,isComments:this.props.stickerInterface==q.COMMENTS}));}.bind(this)),ga=[];for(var ha=0;ha<fa.length;ha+=aa){var ia=ha;ha===0&&ha++;ga.push(k.createElement('div',{className:"_5r81",key:ha},fa.slice(ia,ha+aa)));}return ga;},_renderStoreButton:function(){return (k.createElement('a',{'aria-label':ca,className:"_5r86 rfloat",'data-hover':'tooltip','data-tooltip-content':ca,onClick:this._openStore},k.createElement(m,{className:"_5r87",src:x('/images/messaging/stickers/selector/sticker_store.png')}),this._renderJewel()));},_renderJewel:function(){var fa=this.props.numNewPacks;if(!fa)return null;return (k.createElement(t,{className:"rfloat _3fhs",count:fa,maxcount:9,type:'special'}));},_renderPrevArrow:function(){if(!this._canGoPrev())return null;var fa=j.isRTL()?x('/images/messaging/stickers/selector/right.png'):x('/images/messaging/stickers/selector/left.png');return (k.createElement('a',{className:"_37wu"+(' '+"lfloat"),onClick:this._goPrev},k.createElement(m,{className:"_5r84",src:fa})));},_renderNextArrow:function(){if(!this._canGoNext())return null;var fa=j.isRTL()?x('/images/messaging/stickers/selector/left.png'):x('/images/messaging/stickers/selector/right.png');return (k.createElement('a',{className:"_37wv"+(' '+"rfloat"),onClick:this._goNext},k.createElement(m,{className:"_5r84",src:fa})));}}),ea=k.createClass({displayName:'PackIcon',propTypes:{index:z.number,isComments:z.bool,onClick:z.func,pack:z.instanceOf(i).isRequired,selected:z.bool},getDefaultProps:function(){return {isComments:false,onClick:v};},_getPackIcon:function(fa){if(fa.id==p.SEARCH_PACK_ID)return x('/images/messaging/stickers/icons/search.png');if(fa.id==p.MRU_STICKER_PACK)return x('/images/messaging/stickers/icons/recent.png');if(fa.id==p.EMOTICON_PACK_ID)return x('/images/messaging/stickers/icons/emoji.png');return fa.icon;},render:function(){var fa=this.props.pack,ga=o.WebStickerSearch?this.props.index===1||this.props.index===2:this.props.index===1,ha="_5r8a"+(this.props.selected?' '+"_5r8b":'')+(fa.id==p.MRU_STICKER_PACK?' '+"_5qcj":'')+(fa.id==p.SEARCH_PACK_ID?' '+"_5qck":'')+(ga?' '+"_eb3":''),ia=this.props.isComments&&!fa.isCommentsCapable,ja=w._("This pack is only available in photos"),ka=w._("This pack is only available in messages"),la=ia?v:function(){return this.props.onClick(fa.id);}.bind(this),ma=this._getPackIcon(fa);if(ma===null)return null;var na=ka;if(!fa.isMessengerCapable&&fa.isComposerCapable)na=ja;return (k.createElement('a',{'aria-label':ia?na:fa.name,className:ha,'data-id':fa.id,'data-hover':'tooltip','data-tooltip-content':ia?na:fa.name,ref:'search_icon',onClick:la,tabIndex:'0'},k.createElement(m,{className:(ia?"_2ji6":'')+(' '+"_5r8c")+(o.WebStickerSearch?' '+"_1viy":''),src:ma})));}});f.exports=da;},null);
__d('StickersFlyoutStickerSelector.react',['BanzaiLogger','Grid.react','Image.react','ScrollableArea.react','React','Sticker.react','StickerConstants','StickerImages','StickerInterfaces','StickerSearch','StickerState','StickerUtils','XUISpinner.react','cx','debounce','emptyFunction','fbt','getObjectValues','ix','throttle'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa){'use strict';if(c.__markCompiled)c.__markCompiled();var ba=i.GridItem,ca=l.PropTypes,da=320,ea=278,fa=n.MRU_STICKER_PACK,ga=44,ha=112,ia=v(function(ka,la){if(!ka)return;h.log('StickersLoggerConfig',{event:'search_sticker',searchtoken:ka,numsearchresults:la.length});},1000),ja=l.createClass({displayName:'StickersFlyoutStickerSelector',propTypes:{height:ca.number,stickerInterface:ca.oneOf(y(p)),onScroll:ca.func,onStickerClick:ca.func.isRequired,onStickerKeyDown:ca.func.isRequired,packID:ca.string,userInput:ca.string},getDefaultProps:function(){return {stickerInterface:p.MESSAGES,onScroll:w};},getInitialState:function(){return {loading:false,stickers:[]};},componentDidMount:function(){if(this.props.packID){this.requestStickersForPack(this.props.packID);return;}if(this.props.userInput)this.requestStickersForQuery(this.props.userInput,this.props.stickerInterface);},componentWillReceiveProps:function(ka){if(ka.packID&&ka.packID!==this.props.packID){this.requestStickersForPack(ka.packID);}else if(ka.userInput!==this.props.userInput)this.requestStickersForQuery(ka.userInput,this.props.stickerInterface);},requestStickersForQuery:function(ka,la){this.setState({loading:true});q.requestStickersForQuery(ka,la,function(ma){ma.map(function(na){return o.cacheSticker(na);});if(!this.props.tagChosen)ia(ka,ma);if(this.isMounted())this.setState({loading:false,stickers:ma});}.bind(this));},requestStickersForPack:function(ka){this.setState({loading:true});o.requestStickersForPack(ka,n.TRAY_SIZE,function(la){if(ka==fa){la=r.getMRUStickerPack(la);if(this.props.stickerInterface==p.COMPOSER)la=la.filter(function(ma){return ma.isComposerCapable;});if(this.props.stickerInterface==p.COMMENTS)la=la.filter(function(ma){return ma.isCommentsCapable;});if(this.props.stickerInterface==p.MESSAGES)la=la.filter(function(ma){return ma.isMessengerCapable;});}this.setState({loading:false,stickers:la});}.bind(this));},renderStickers:function(){return this.state.stickers.map(function(ka){var la=s.getScaledDimensions(ka.height,ka.width,n.TRAY_SIZE);return (l.createElement(ba,{key:ka.id},l.createElement('div',{className:"_5r8h",onClick:function(event){return this.props.onStickerClick(ka.id,event);}.bind(this),onKeyDown:function(event){return this.props.onStickerKeyDown(ka.id,event);}.bind(this)},l.createElement(m,{accessibilityLabel:ka.accessibilityLabel,animationTrigger:'hover',className:"_5r8i",forceCursorPointer:true,frameCount:ka.frameCount,frameRate:ka.frameRate||83,framesPerCol:ka.framesPerCol,framesPerRow:ka.framesPerRow,sourceHeight:la.height,sourceURI:ka.sourceURI,sourceWidth:la.width,spriteURI:ka.spriteURI,packName:ka.packName,paddedSpriteURI:ka.paddedSpriteURI,stickerID:ka.id}))));}.bind(this));},_onScroll:function(){var ka=this.refs.stickerScrollable;if(ka){var la=ka.getArea().getScrollTop();this.props.onScroll(la);}},render:function(){if(this.state.loading){return (l.createElement('div',{className:"_e0r"},l.createElement(t,{size:'large'})));}else if(this.state.stickers.length===0){var ka=(da-ga*2-ha)/2+'px';return (l.createElement('div',{className:"_5jdt",style:{marginTop:ka}},l.createElement(j,{src:z('/images/messaging/stickers/icons/sad_face.png')}),l.createElement('p',null,x._("No Stickers to Show"))));}return (l.createElement(k,{ref:'stickerScrollable',height:this.props.height||da,onScroll:aa(this._onScroll,200),width:ea,fade:true},l.createElement('div',{className:"_5r8k"},l.createElement(i,{cols:4,fixed:true},this.renderStickers()))));}});f.exports=ja;},null);
__d('StickersFlyoutTagSelector.react',['BanzaiLogger','Grid.react','ScrollableArea.react','React','ReactDOM','Image.react','StickersFlyoutStickerSelector.react','StickerInterfaces','StickerState','StickerUtils','XUIButton.react','XUICloseButton.react','XUITextInput.react','cx','fbt','getObjectValues'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w){'use strict';if(c.__markCompiled)c.__markCompiled();var x=i.GridItem,y=k.PropTypes,z=320,aa=278,ba=44,ca=k.createClass({displayName:'StickersFlyoutTagSelector',propTypes:{onStickerClick:y.func.isRequired,onStickerKeyDown:y.func.isRequired,stickerInterface:y.oneOf(w(o))},getInitialState:function(){return {input:'',isScrolling:false,tagChosen:false};},getDefaultProps:function(){return {stickerInterface:o.MESSAGES};},componentDidMount:function(){this.focusInput();},focusInput:function(){setTimeout(function(){if(this.refs.inputField&&this.refs.inputField.focusInput)this.refs.inputField.focusInput();}.bind(this));},_inputChanged:function(da){this.setState({input:da.target.value,tagChosen:false,isScrolling:false});},_normalizeInput:function(da){return da.trim().replace(/\s+/,' ').toLowerCase();},_handleResetButtonClick:function(da){da.preventDefault();this.reset();},reset:function(){this.setState(this.getInitialState());},renderContentArea:function(){if(this.state.tagChosen||this._normalizeInput(this.state.input).length>1){return this.renderStickers();}else return this.renderTags();},render:function(){return (k.createElement('div',{className:"_217a"+(this.state.isScrolling?' '+"_1hg1":'')},k.createElement('div',{className:"_5jdr"},k.createElement('span',{className:"_5jds"}),k.createElement(t,{onChange:this._inputChanged,ref:'inputField',placeholder:v._("Search stickers"),value:this.state.input}),k.createElement(s,{size:'small',onClick:this._handleResetButtonClick,className:this.state.input.length===0?"hidden_elem":''})),this.renderContentArea()));},selectTag:function(da){h.log('StickersLoggerConfig',{event:'select_tag',tagid:da.id});this.setState({tagChosen:true,input:q.capitalizeWords(da.name)});this.focusInput();},_onScroll:function(da){this.setState({isScrolling:!!da});},renderStickers:function(){var da=this._normalizeInput(this.state.input);return (k.createElement(n,{ref:'selector',height:z-ba,userInput:da,onScroll:this._onScroll,onStickerClick:this.props.onStickerClick,onStickerKeyDown:this.props.onStickerKeyDown,stickerInterface:this.props.stickerInterface,tagChosen:this.state.tagChosen}));},renderTags:function(){var da=p.getFeaturedTags().filter(function(ea){return ea.sourceURI!==null;}).sort(function(ea,fa){return ea.order-fa.order;}).map(function(ea,fa){return (k.createElement(x,{key:fa},k.createElement('div',{className:"_t5c"+(fa<2?' '+"_1b27":'')+(fa%2===0?' '+"_t5d":'')+(fa%2!==0?' '+"_t5e":'')},k.createElement(r,{image:k.createElement(m,{src:ea.sourceURI}),label:ea.name,onClick:this.selectTag.bind(this,ea),className:"_5jdu",style:{background:'#'+ea.color_code},disabled:this._normalizeInput(this.state.input).length===1}))));}.bind(this));return (k.createElement(j,{height:z-ba,width:aa-16,shadow:true,fade:true,className:"_5jei"},k.createElement(i,{spacing:'pas',cols:2,fixed:true,ref:'grid'},da)));}});f.exports=ca;},null);
__d('StickersFlyout.react',['BanzaiLogger','Event','Keys','MessagesEmoticons.react','ReactComponentWithPureRenderMixin','React','ReactDOM','StickerActions','StickerConfig','StickerConstants','StickerInterfaces','StickersFlyoutPackSelector.react','StickersFlyoutStickerSelector.react','StickersFlyoutTagSelector.react','StickerState','StickerStateStore','StoreAndPropBasedStateMixin','XUISpinner.react','csx','cx','fbt','getObjectValues','joinClasses'],function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,aa,ba,ca,da){'use strict';if(c.__markCompiled)c.__markCompiled();var ea=m.PropTypes,fa=q.SEARCH_PACK_ID,ga=[j.BACKSPACE,j.TAB,j.RETURN,j.ALT,j.ESC,j.SPACE,j.PAGE_UP,j.PAGE_DOWN,j.END,j.HOME,j.LEFT,j.UP,j.RIGHT,j.DOWN,j.DELETE],ha=m.createClass({displayName:'StickersFlyout',mixins:[l,x(w)],statics:{calculateState:function(ia){var ja=w.getState(ia.stickerInterface);return {dataReady:ja.trayDataReady,packID:ja.packID,numNewPacks:ja.numNewPacks,packs:ja.trayPacks};}},propTypes:{stickerInterface:ea.oneOf(ca(r)),onStickerSelect:ea.func.isRequired,onEmoticonSelect:ea.func,onShown:ea.func,onHidden:ea.func,onEscKeyDown:ea.func,shown:ea.bool},getDefaultProps:function(){return {stickerInterface:r.MESSAGES,shown:false};},componentDidMount:function(){if(this.props.shown)this._onShown();},componentWillReceiveProps:function(ia){if(ia.shown){this._onShownWrapper();}else this._onHidden();},_onShownWrapper:function(){if(this.props.onShown){this.props.onShown(this._onShown);}else this._onShown();},_onShown:function(){h.log('StickersLoggerConfig',{event:'open_tray'});if(!this.state.dataReady)this.loadTrayData();if(this.state.packID===fa)this.refs.tagSelector&&this.refs.tagSelector.focusInput();this.refs.packSelector.onFlyoutShown();},_onHidden:function(){this.resetTagSelector();this.props.onHidden&&this.props.onHidden();},componentDidUpdate:function(ia){if(!ia.shown&&this.props.shown){this._onShown();}else if(ia.shown&&!this.props.shown)this._onHidden();},_onKeyDown:function(event){if(event.keyCode===j.ESC&&this.props.onEscKeyDown){event.preventDefault();event.stopPropagation();this.props.onEscKeyDown();}else if(this.state.packID!==fa&&ga.indexOf(event.keyCode)===-1){o.selectPack(fa);this.setState(ha.calculateState(this.props));}},resetTagSelector:function(){this.refs.tagSelector&&this.refs.tagSelector.reset();},loadTrayData:function(){v.onTrayDataReady(function(){}.bind(this));},loadPack:function(){if(!this.state.dataReady)return (m.createElement('div',{className:"_e0r"},m.createElement(y,{size:'large'})));if(this.state.packID===q.EMOTICON_PACK_ID)return (m.createElement('div',{className:"_5r8l",'data-id':this.state.packID},m.createElement(k,{onEmoticonSelect:this.props.onEmoticonSelect})));if(this.state.packID===fa&&p.WebStickerSearch)return (m.createElement('div',{className:"_5r8l"},m.createElement(u,{ref:'tagSelector',className:"fbStickersFlyoutTagSelector",onStickerClick:this._onStickerClick,onStickerKeyDown:this._onStickerKeyDown,stickerInterface:this.props.stickerInterface})));return (m.createElement('div',{className:"_5r8l",'data-id':this.state.packID},m.createElement(t,{ref:'selector',packID:this.state.packID,onStickerClick:this._onStickerClick,onStickerKeyDown:this._onStickerKeyDown,stickerInterface:this.props.stickerInterface})));},_onStickerClick:function(ia,event){v.updateRecentlyUsed(ia);this.props.onStickerSelect(ia,event);v.clearShowStickerReplyNUX();},_onStickerKeyDown:function(ia,event){if(event.keyCode===j.RETURN){event.stopPropagation();event.preventDefault();this._onStickerClick(ia,event);}},render:function(){return (m.createElement('div',{'aria-label':ba._("Stickers"),className:da(this.props.className,"_5r8f"),onKeyDown:this._onKeyDown,role:'dialog'},m.createElement('div',{className:"_5r8e"},m.createElement(s,{ref:'packSelector',numNewPacks:this.state.numNewPacks,selectedPackID:this.state.packID,packs:this.state.packs,stickerInterface:this.props.stickerInterface,resetTagSelectorFunc:this.resetTagSelector})),m.createElement('div',{className:"_5r8m"},this.loadPack())));}});f.exports=ha;},null);